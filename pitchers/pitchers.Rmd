---
title: "Pitchers"
author: "Jason Scheer"
date: "2024-04-28"
output: pdf_document
---


```{r}
library(readr)
library(tidyverse)
library(dplyr)
hit = read_csv("hit.csv")
non_hit1 = read_csv("non_hit1.csv")
non_hit2 = read_csv("non_hit2.csv")
non_hit = rbind(non_hit1, non_hit2)


# This is what I used to get those csv files


#library(tidyverse)
#library(Lahman)
#library(readr)
#
#
#sc = read_csv("~/Downloads/statcast.csv")
#
#sc2 = sc |> 
#  select(c("pitcher_name", "pitch_type", "game_year", "zone", "p_throws", "type", "stand", #"plate_x", "plate_z", "hc_x", "hc_y", "sz_top", "sz_bot", "hit_distance_sc", "launch_speed", #"launch_angle"))
#
#
#
#non_hit1 = sc2 |> 
#  filter(type != "X") |> 
#  select(c("pitcher_name", "pitch_type", "game_year", "zone", "type", "stand", "plate_x", #"plate_z", "sz_top", "sz_bot")) |> 
#  filter(game_year < 2020)
#
#non_hit2 = sc2 |> 
#  filter(type != "X") |> 
#  select(c("pitcher_name", "pitch_type", "game_year", "zone", "type", "stand", "plate_x", #"plate_z", "sz_top", "sz_bot")) |> 
#  filter(game_year >= 2020)
#
#hit = sc2 |> 
#  filter(type == "X")


# I had to divide the non hits into two because of the file size
```



```{r}
pitch_count = non_hit |> 
  group_by(pitcher_name, game_year) |> 
  summarise(total_pitches = n(), .groups = "keep") |> 
  filter(total_pitches >= 1000) # Arbitrary number to filter out players who didn't pitch much in a season 

unique_pitchers = unique(pitch_count$pitcher_name) 
unique_pitchers <- unique_pitchers[unique_pitchers != "Reynald"]
non_hit = non_hit |> 
  filter(pitcher_name != "Reynald")


remove_accents = function(string) {
  iconv(string, "ASCII//TRANSLIT")
}
unique_pitchers = lapply(unique_pitchers, remove_accents)
unique_pitchers = unlist(unique_pitchers)
unique_pitchers = sort(unique_pitchers)
```


```{r}
library(shiny)

# UI
ui <- navbarPage(
  title = "Pitchers Location",
  tabPanel(
    title = "Pitcher's Strike Sone",
    titlePanel(title = "MLB Statcast data: 2017-2022"),
    sidebarLayout(
      sidebarPanel(
        selectInput(
          inputId = "pitcher",
          label = "Pitcher: ",
          choices  = unique_pitchers,
          selected = "Justin Steele"),
        selectInput(
          inputId = "stand",
          label = "Against Lefty or Righty?",
          choices = c("Lefty" = 1, "Righty" = 0),
          selected = "Righty"),
        selectInput(
          inputId = "pitch_type",
          label = "Pitch Type",
          choices = c("CH" = 1, "CU" = 2, "FC" = 3, "FF" = 4, "FO" = 5, "FS" = 6, "FT" = 7, "KC" = 8, "KN" = 9, "SC" = 10, "SI" = 11, "SL" = 12),
          selected = "FF"),
        selectInput(
          inputId = "year",
          label = "Year",
          choices = c("2017" = 2017, "2018" = 2018, "2019" = 2019, "2020" = 2020, "2021" = 2021, "2022" = 2022, "All" = 1),
          selected = "All")
      ),
      mainPanel(plotOutput("plot"))
    )
  ),
  tabPanel(title = "About", includeMarkdown(""))
)

# Server
server <- function(input, output, session) {
  
  observe({
    # Update choices for pitch type based on selected pitcher
    updateSelectInput(session, "pitch_type", choices = unique(non_hit$pitch_type))
    
    # Update choices for year based on selected pitcher
    updateSelectInput(session, "year", choices = unique(non_hit$game_year))
  })
  
  output$plot <- renderPlot({
    filtered_data <- non_hit %>%
      filter(
        pitcher_name == input$pitcher,
        stand == input$stand,
        pitch_type == input$pitch_type,
        game_year == input$year
      )
    
    # Create a scatter plot of pitch locations with different colors for different pitch types
    p <- ggplot(filtered_data, aes(x = plate_x, y = plate_z, color = pitch_type)) +
      geom_point() +  # Scatter plot of pitch locations
      labs(x = "Horizontal Location", y = "Vertical Location", color = "Pitch Type") +  # Axis and legend labels
      ggtitle("Pitcher Location") +  # Plot title
      theme_minimal() +  # Minimal theme
      scale_color_discrete(name = "Pitch Type")  # Custom legend title
    
    # Return the ggplot plot
    p
  })
}

# Run the application 
shinyApp(ui = ui, server = server)

```



```{r}
library(shiny)

# UI
ui = navbarPage(
  title = "Switch Hitting Advantage or Disadvantage?",
  tabPanel(
    title = "Visualization",
    titlePanel(title = "Switch Hitting OBP Data 2017-2022"),
    sidebarLayout(
      sidebarPanel(
        selectInput(
          inputId = "batter",
          label = "Batter:",
          choices  = unique_batters,
          selected = "Ian Happ"),
      ),
      mainPanel(plotOutput("plot"))
    )
    
  ),
  tabPanel(title = "About", includeMarkdown("This Shiny App looks at players who have at least 100 PAs as a righty and as a lefty and compares their seasonal OBP to the league average OBP. The purpose of this is to see if being a switch hitter is actually beneifical for the hitter or if they might be better off just sticking to working on getting better at just one side of the plate. Unfortuantely I could only obtain this data from statcast so it is only from 2017-2022 seasons, so we can only see current and recently retired switch hitters. The data is setup where the bars are the OBP as a lefty and righty from 2017-2022 for everyone that had enough switch hitting PAs. The dashed line is the league average OBP for each season. There are a few players that will have just one stand in their graph because of not having enough plate appearances to make the threshold for both stands. Also I apologize for the double league average OBP above each year. I could only get it to show for each stand instead for each year."))
)

# Server
server = function(input, output) {
  
  
output$plot = renderPlot({
  filtered_obp = obp[obp$batter_name == input$batter, ]
  
  ggplot(data = filtered_obp, aes(x = game_year, y = OBP, fill = stand, color = stand)) +
    geom_bar(stat = "identity", position = "dodge") +
    geom_text(aes(label = round(OBP, 3)), position = position_dodge(width = 0.9), vjust = 1.2, size = 3, color = "black") +
    geom_line(aes(x = game_year, y = OBP_avg, group = 1), data = filtered_obp, color = "darkblue", linetype = "dashed") +
    geom_point(aes(x = game_year, y = OBP_avg), data = filtered_obp, color = "darkblue", size = 2) +  
    geom_text(aes(label = round(OBP_avg, 3)), data = filtered_obp, vjust = -0.3, size = 3, color = "darkblue", nudge_y = 0.03) +
    scale_y_continuous(labels = function(x) round(x, 3)) +  
    labs(x = "Year", y = "OBP", fill = "Stand", color = "Stand") +
    theme_bw()
})

}

# Run the application 
shinyApp(ui = ui, server = server)



        selectInput(
          inputId = "ball",
          label = "Called Strikes or Called Balls?",
          choices = c("Both" = 2,"Strikes" = 1, "Balls" = 0),
          selected = "Both")

```



